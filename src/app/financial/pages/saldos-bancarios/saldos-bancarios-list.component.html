<div>
  <!-- Page Header -->
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <h2 class="text-title-md2 font-semibold text-black dark:text-white flex flex-col sm:flex-row sm:items-center gap-2">
      <span *ngIf="selectedStore">{{ selectedStore.name }}</span>
      <span *ngIf="selectedStore" class="hidden sm:inline text-gray-400 font-normal">|</span>
      <span [class.text-lg]="selectedStore" [class.text-gray-500]="selectedStore" [class.font-normal]="selectedStore">
        Saldos Bancários
      </span>
    </h2>
    <div class="flex items-center gap-4">
      <button
        (click)="loadBankAccounts()"
        class="inline-flex items-center justify-center gap-2 rounded-lg bg-white border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-gray-100 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-700 dark:focus:ring-gray-700"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
        </svg>
        Atualizar
      </button>
    </div>
  </div>

  <div class="grid grid-cols-12 gap-4 md:gap-6">
  <!-- Slider Section -->
  <div class="col-span-12 xl:col-span-7">
    <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] sm:p-6 overflow-hidden h-full">
      <div class="flex justify-between mb-6">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">
          Contas
        </h3>

        <div class="stocks-slider-outer relative flex items-center gap-1.5">
          <div (click)="swiperInstance?.slidePrev()" class="swiper-button-prev cursor-pointer hover:text-brand-500">
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M10.1667 4L6 8.16667L10.1667 12.3333"
                stroke="currentColor"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
          </div>

          <div (click)="swiperInstance?.slideNext()" class="swiper-button-next cursor-pointer hover:text-brand-500">
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M5.83333 12.6667L10 8.50002L5.83333 4.33335"
                stroke="currentColor"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
          </div>
        </div>
      </div>

      <div class="stocksSlider" style="min-width: 0; width: 100%; max-width: 100%; overflow: hidden;">
        <swiper-container
          #swiperRef
          style="width: 100%; display: block;"
          slides-per-view="1"
          loop="false"
          space-between="20"
          [breakpoints]="{
            '768': {
              slidesPerView: 2
            },
            '1024': {
              slidesPerView: 1.5
            },
            '1400': {
              slidesPerView: 2
            }
          }"
          navigation-prev-el=".swiper-button-prev"
          navigation-next-el=".swiper-button-next"
         >
          <!-- Bank Account Item -->
          @for (account of bankAccounts; track $index) {
          <swiper-slide class="h-auto p-1">
            <div class="max-w-[350px] rounded-xl border border-gray-200 bg-white p-5 shadow-sm dark:border-gray-800 dark:bg-white/[0.03] relative group cursor-pointer transition-all duration-200"
                 [class.ring-2]="selectedAccount?.id_code === account.id_code"
                 [class.ring-brand-500]="selectedAccount?.id_code === account.id_code"
                 (click)="selectAccount(account)">

              <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3 overflow-hidden">
                  <div class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 shrink-0">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"></path>
                    </svg>
                  </div>
                  <div class="overflow-hidden min-w-0">
                    <h4 class="text-base font-semibold text-gray-800 dark:text-white/90 flex items-center gap-2 truncate">
                      {{ account.name }}
                      <span *ngIf="account.is_default" class="text-[10px] bg-brand-100 text-brand-700 px-1.5 py-0.5 rounded border border-brand-200 dark:bg-brand-900/30 dark:text-brand-300 dark:border-brand-800 shrink-0">
                        {{ 'financial.bankAccount.table.default' | translate }}
                      </span>
                    </h4>
                    <p class="text-sm font-medium text-gray-600 dark:text-gray-300 truncate">{{ account.bank_name }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Ag: {{ account.agency }} / CC: {{ account.account_number }}</p>
                  </div>
                </div>
              </div>
              <div class="pt-4 border-t border-gray-100 dark:border-gray-800">
                <div class="flex justify-between items-end">
                  <span class="text-xs text-gray-500 dark:text-gray-400">{{ 'financial.bankAccount.table.balance' | translate }}</span>
                  <span class="text-lg font-bold" [ngClass]="{'text-green-600 dark:text-green-400': account.balance >= 0, 'text-red-600 dark:text-red-400': account.balance < 0}">
                    {{ account.balance | currency:'BRL' }}
                  </span>
                </div>
              </div>
            </div>
          </swiper-slide>
          }
        </swiper-container>
      </div>
    </div>
  </div>

  <!-- Analytics/KPI Section -->
  <div class="col-span-12 xl:col-span-5">
    <div class="rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6 h-full">
      <div class="flex items-start justify-between">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">
          Resumo Financeiro
        </h3>
        <div class="relative inline-block">
          <button class="dropdown-toggle" (click)="toggleDropdown()">
            <svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 size-6"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.2441 6C10.2441 5.0335 11.0276 4.25 11.9941 4.25H12.0041C12.9706 4.25 13.7541 5.0335 13.7541 6C13.7541 6.9665 12.9706 7.75 12.0041 7.75H11.9941C11.0276 7.75 10.2441 6.9665 10.2441 6ZM10.2441 18C10.2441 17.0335 11.0276 16.25 11.9941 16.25H12.0041C12.9706 16.25 13.7541 17.0335 13.7541 18C13.7541 18.9665 12.9706 19.75 12.0041 19.75H11.9941C11.0276 19.75 10.2441 18.9665 10.2441 18ZM11.9941 10.25C11.0276 10.25 10.2441 11.0335 10.2441 12C10.2441 12.9665 11.0276 13.75 11.9941 13.75H12.0041C12.9706 13.75 13.7541 12.9665 13.7541 12C13.7541 11.0335 12.9706 10.25 12.0041 10.25H11.9941Z" fill="currentColor"></path></svg>
          </button>

          <app-dropdown [isOpen]="isOpen" (close)="closeDropdown()" className="w-40 p-2">
            <app-dropdown-item (itemClick)="closeDropdown()"
              className="flex w-full font-normal text-left text-gray-500 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300">
              Ver Detalhes
            </app-dropdown-item>
            <app-dropdown-item (itemClick)="closeDropdown(); exportToCsv()"
              className="flex w-full font-normal text-left text-gray-500 rounded-lg hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-white/5 dark:hover:text-gray-300">
              Exportar
            </app-dropdown-item>
          </app-dropdown>
        </div>
      </div>

      <div class="mt-6 flex items-end gap-1.5">
        <div class="flex items-center gap-2.5">
          <div class="flex items-center justify-center w-5 h-5 rounded-full ripple" [ngClass]="kpiBalance >= 0 ? 'bg-success-500/10' : 'bg-error-500/10'">
            <div class="h-1.5 w-1.5 rounded-full" [ngClass]="kpiBalance >= 0 ? 'bg-success-500' : 'bg-error-500'"></div>
          </div>
          <span class="font-semibold text-gray-800 text-title-sm dark:text-white/90">
            {{ kpiBalance | currency:'BRL' }}
          </span>
        </div>
        <span class="block mb-1 text-gray-500 text-theme-sm dark:text-gray-400">
          Saldo Período
        </span>
      </div>

      <div class="my-5 min-h-[155px]">
        <apx-chart
          [series]="chartSeries"
          [chart]="chartOptions"
          [colors]="chartColors"
          [fill]="chartFill"
          [stroke]="chartStroke"
          [grid]="chartGrid"
          [dataLabels]="chartDataLabels"
          [tooltip]="chartTooltip"
          [xaxis]="chartXAxis"
          [yaxis]="chartYAxis"
        ></apx-chart>
      </div>

      <div class="flex items-center justify-center gap-6">
        <div>
          <p class="text-lg font-semibold text-center text-gray-800 dark:text-white/90">
            {{ kpiTotalIn | currency:'BRL' }}
          </p>
          <p class="mt-0.5 text-center text-theme-xs text-gray-500 dark:text-gray-400">
            Entradas
          </p>
        </div>
        <div class="w-px bg-gray-200 h-11 dark:bg-gray-800"></div>
        <div>
          <p class="text-lg font-semibold text-center text-gray-800 dark:text-white/90">
            {{ kpiTotalOut | currency:'BRL' }}
          </p>
          <p class="mt-0.5 text-center text-theme-xs text-gray-500 dark:text-gray-400">
            Saídas
          </p>
        </div>
      </div>
    </div>
  </div>
  </div>


  <!-- Card da tabela -->
  <div class="mt-6 rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
    <!-- Filters Section -->
    <div class="px-4 py-4 border-b border-gray-200 dark:border-gray-800">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:flex-wrap">


        <!-- Date Filter -->
        <div class="w-full sm:w-auto flex flex-col sm:flex-row gap-3">
          <div class="w-full sm:w-40">
            <label class="mb-1.5 block text-xs font-medium text-gray-700 dark:text-gray-400">
              Período
            </label>
            <div class="relative z-20 bg-transparent">
              <select
                [(ngModel)]="dateInterval"
                (ngModelChange)="onDateIntervalChange()"
                class="w-full py-2 pl-3 pr-8 text-sm text-gray-800 bg-transparent border border-gray-300 rounded-lg appearance-none h-[42px] focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
              >
                <option value="15">Últimos 15 dias</option>
                <option value="30">Últimos 30 dias</option>
                <option value="60">Últimos 60 dias</option>
                <option value="90">Últimos 90 dias</option>
                <option value="custom">Personalizado</option>
              </select>
              <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-2 top-1/2 dark:text-gray-400">
                <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" /></svg>
              </span>
            </div>
          </div>

          <div class="w-full sm:w-auto flex gap-2" *ngIf="dateInterval === 'custom'">
            <div class="w-1/2 sm:w-auto min-w-[140px]">
              <app-date-picker
            id="start-date"
            label="De"
            labelSize="text-xs"
            [defaultDate]="startDate || undefined"
            (dateChange)="onStartDateChange($event)"
          ></app-date-picker>
        </div>
        <div class="w-1/2 sm:w-auto min-w-[140px]">
          <app-date-picker
            id="end-date"
            label="Até"
            labelSize="text-xs"
            [minDate]="startDate || undefined"
            [defaultDate]="endDate || undefined"
            (dateChange)="onEndDateChange($event)"
          ></app-date-picker>
        </div>
          </div>

          <div *ngIf="isLoadingTransactions" class="flex items-center justify-center self-end h-[42px] px-2">
            <svg class="animate-spin h-5 w-5 text-brand-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
      </div>
    </div>

    <!-- Search, Pagination and Export -->
    <div class="flex flex-col gap-2 px-4 py-4 border-b border-gray-200 dark:border-gray-800 sm:flex-row sm:items-center sm:justify-between">
      <div class="flex items-center gap-3">
        <span class="text-gray-500 dark:text-gray-400">
          {{ 'financial.transactions.table.pagination.show' | translate }}
        </span>
        <div class="relative z-20 bg-transparent">
          <select
            [(ngModel)]="itemsPerPage"
            (ngModelChange)="onItemsPerPageChange()"
            class="w-full py-2 pl-3 pr-8 text-sm text-gray-800 bg-transparent border border-gray-300 rounded-lg appearance-none h-9 bg-none shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"
          >
            <option [value]="5" class="text-gray-500 dark:bg-gray-900 dark:text-gray-400">5</option>
            <option [value]="10" class="text-gray-500 dark:bg-gray-900 dark:text-gray-400">10</option>
            <option [value]="20" class="text-gray-500 dark:bg-gray-900 dark:text-gray-400">20</option>
            <option [value]="50" class="text-gray-500 dark:bg-gray-900 dark:text-gray-400">50</option>
          </select>
          <span class="absolute z-30 text-gray-500 -translate-y-1/2 right-2 top-1/2 dark:text-gray-400">
            <svg class="stroke-current" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3.8335 5.9165L8.00016 10.0832L12.1668 5.9165" stroke="" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round" />
            </svg>
          </span>
        </div>
        <span class="text-gray-500 dark:text-gray-400">
          {{ 'financial.transactions.table.pagination.entries' | translate }}
        </span>
      </div>

      <div class="flex flex-col sm:flex-row gap-3 items-center">
        <!-- Type Filter (Switch Style) -->
        <div class="inline-flex h-11 items-center gap-0.5 rounded-lg bg-gray-100 p-0.5 dark:bg-gray-900">
          <button
            type="button"
            (click)="onTypeFilterChange('all')"
            class="text-theme-sm h-10 rounded-md px-3 py-2 font-medium hover:text-gray-900 dark:hover:text-white"
            [ngClass]="{'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800': typeFilter === 'all', 'text-gray-500 dark:text-gray-400': typeFilter !== 'all'}">
            Todos
          </button>
          <button
            type="button"
            (click)="onTypeFilterChange('RECEIVABLE')"
            class="text-theme-sm h-10 rounded-md px-3 py-2 font-medium hover:text-gray-900 dark:hover:text-white"
            [ngClass]="{'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800': typeFilter === 'RECEIVABLE', 'text-gray-500 dark:text-gray-400': typeFilter !== 'RECEIVABLE'}">
            Entradas
          </button>
          <button
            type="button"
            (click)="onTypeFilterChange('PAYABLE')"
            class="text-theme-sm h-10 rounded-md px-3 py-2 font-medium hover:text-gray-900 dark:hover:text-white"
            [ngClass]="{'shadow-theme-xs text-gray-900 dark:text-white bg-white dark:bg-gray-800': typeFilter === 'PAYABLE', 'text-gray-500 dark:text-gray-400': typeFilter !== 'PAYABLE'}">
            Saídas
          </button>
        </div>

        <!-- Search -->
        <div class="relative w-full sm:w-auto">
          <span class="absolute text-gray-500 -translate-y-1/2 pointer-events-none left-4 top-1/2 dark:text-gray-400">
            <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M3.04199 9.37363C3.04199 5.87693 5.87735 3.04199 9.37533 3.04199C12.8733 3.04199 15.7087 5.87693 15.7087 9.37363C15.7087 12.8703 12.8733 15.7053 9.37533 15.7053C5.87735 15.7053 3.04199 12.8703 3.04199 9.37363ZM9.37533 1.54199C5.04926 1.54199 1.54199 5.04817 1.54199 9.37363C1.54199 13.6991 5.04926 17.2053 9.37533 17.2053C11.2676 17.2053 13.0032 16.5344 14.3572 15.4176L17.1773 18.238C17.4702 18.5309 17.945 18.5309 18.2379 18.238C18.5308 17.9451 18.5309 17.4703 18.238 17.1773L15.4182 14.3573C16.5367 13.0033 17.2087 11.2669 17.2087 9.37363C17.2087 5.04817 13.7014 1.54199 9.37533 1.54199Z" fill=""></path>
            </svg>
          </span>
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearch()"
            [placeholder]="'financial.transactions.table.searchPlaceholder' | translate"
            class="dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pl-11 pr-4 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 xl:w-[300px]"
          />
        </div>
        
        <button
          type="button"
          (click)="exportToCsv()"
          class="shadow-theme-xs flex w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-[11px] text-sm font-medium text-gray-700 sm:w-auto dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M16.6671 13.3333V15.4166C16.6671 16.1069 16.1074 16.6666 15.4171 16.6666H4.58301C3.89265 16.6666 3.33301 16.1069 3.33301 15.4166V13.3333M10.0013 3.33325L10.0013 13.3333M6.14553 7.18708L9.99958 3.33549L13.8539 7.18708" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
          {{ 'financial.transactions.actions.exportCsv' | translate }}
        </button>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full table-auto">
        <thead>
          <tr class="border-b border-gray-200 dark:divide-gray-800 dark:border-gray-800">
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400 cursor-pointer" (click)="handleSort('date')">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                Data
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400 cursor-pointer" (click)="handleSort('type')">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                {{ 'financial.transactions.table.headers.type' | translate }}
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400 cursor-pointer" (click)="handleSort('nf')">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                {{ 'financial.transactions.table.headers.nf' | translate }}
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                {{ 'financial.transactions.table.headers.description' | translate }}
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                {{ 'financial.transactions.table.headers.costCenter' | translate }}
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                {{ 'financial.transactions.table.headers.category' | translate }}
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                Tags
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400 cursor-pointer" (click)="handleSort('amount')">
              <span class="text-theme-xs font-medium text-gray-700 dark:text-gray-400">
                {{ 'financial.transactions.table.headers.amount' | translate }}
              </span>
            </th>
            <th class="p-4 text-left text-xs font-medium text-gray-700 dark:text-gray-400">
              <span class="sr-only">
                {{ 'financial.transactions.table.headers.actions' | translate }}
              </span>
            </th>
          </tr>
        </thead>
        <tbody class="divide-x divide-y divide-gray-200 dark:divide-gray-800">
          <tr *ngFor="let row of paginatedData" class="transition hover:bg-gray-50 dark:hover:bg-gray-900">
            <td class="p-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              {{ row.rawDate | date:'dd/MM/yyyy' }}
            </td>
            <td class="p-4 whitespace-nowrap">
              <span
                [ngClass]="{
                  'bg-red-50 text-red-600 dark:bg-red-500/10 dark:text-red-500': (row.type || 'PAYABLE') === 'PAYABLE',
                  'bg-blue-50 text-blue-600 dark:bg-blue-500/10 dark:text-blue-500': row.type === 'RECEIVABLE' || row.type === 'TRANSFER',
                  'bg-yellow-50 text-yellow-600 dark:bg-yellow-500/10 dark:text-yellow-500': row.type === 'ADJUSTMENT'
                }"
                class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
              >
                {{
                  row.type === 'PAYABLE'
                    ? 'Saída'
                    : row.type === 'RECEIVABLE'
                    ? 'Entrada'
                    : row.type === 'TRANSFER'
                    ? ('financial.transactions.type.transfer' | translate)
                    : row.type === 'ADJUSTMENT'
                    ? ('financial.transactions.type.adjustment' | translate)
                    : 'Saída'
                }}
              </span>
            </td>
            <td class="p-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              {{ row.nf || '-' }}
            </td>
            <td class="p-4 min-w-[300px] text-sm text-gray-700 dark:text-gray-300">
              <span class="block break-words whitespace-normal">
                {{ row.action }}
              </span>
            </td>
            <td class="p-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              {{ row.costCenter }}
            </td>
            <td class="p-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              {{ row.category }}
            </td>
            <td class="p-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              <div class="flex flex-wrap gap-1">
                <span
                  *ngFor="let tag of row.tags"
                  class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium text-white"
                  [style.background-color]="tag.color"
                >
                  {{ tag.name }}
                </span>
              </div>
            </td>
            <td class="p-4 whitespace-nowrap text-sm font-medium text-right" [ngClass]="{'text-red-600 dark:text-red-500': row.type === 'PAYABLE', 'text-gray-900 dark:text-white': row.type !== 'PAYABLE'}">
              <span *ngIf="row.type === 'PAYABLE'">-</span>{{ row.rawAmount | currency:'BRL' }}
            </td>
            <td class="p-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              <div class="flex items-center gap-2">

                <button
                  type="button"
                  (click)="openEvidenceSidebar(row)"
                  class="inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 hover:text-brand-500 dark:text-gray-400 dark:hover:bg-gray-800"
                  [title]="'financial.transactions.actions.evidence' | translate"
                >
                  <svg class="fill-current" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13.7535 2.47502H11.5879V1.9969C11.5879 1.15315 10.9129 0.487524 10.0317 0.487524H7.90672C7.02547 0.487524 6.35047 1.15315 6.35047 1.9969V2.47502H4.18484C3.25672 2.47502 2.47859 3.26252 2.47859 4.2094V14.4563C2.47859 15.4032 3.25672 16.1906 4.18484 16.1906H13.7535C14.6817 16.1906 15.4598 15.4032 15.4598 14.4563V4.2094C15.4598 3.26252 14.6817 2.47502 13.7535 2.47502ZM7.90672 1.9969H10.0317V2.47502H7.90672V1.9969ZM13.7535 14.4563H4.18484V4.2094H13.7535V14.4563Z" fill=""/>
                    <path d="M12.1289 6.99375H5.80938C5.5375 6.99375 5.31562 7.21563 5.31562 7.4875C5.31562 7.75938 5.5375 7.98125 5.80938 7.98125H12.1289C12.4008 7.98125 12.6227 7.75938 12.6227 7.4875C12.6227 7.21563 12.4008 6.99375 12.1289 6.99375Z" fill=""/>
                    <path d="M12.1289 10.2938H5.80938C5.5375 10.2938 5.31562 10.5156 5.31562 10.7875C5.31562 11.0594 5.5375 11.2813 5.80938 11.2813H12.1289C12.4008 11.2813 12.6227 11.0594 12.6227 10.7875C12.6227 10.5156 12.4008 10.2938 12.1289 10.2938Z" fill=""/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 dark:border-gray-800 dark:bg-transparent sm:px-6">
      <div class="flex flex-1 justify-between sm:hidden">
        <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1" class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50">Anterior</button>
        <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages" class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50">Próxima</button>
      </div>
      <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
          <p class="text-sm text-gray-700 dark:text-gray-400">
            Mostrando <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span> até <span class="font-medium">{{ Math.min(currentPage * itemsPerPage, totalItems) }}</span> de <span class="font-medium">{{ totalItems }}</span> resultados
          </p>
        </div>
        <div>
          <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
            <button (click)="onPageChange(currentPage - 1)" [disabled]="currentPage === 1" class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50">
              <span class="sr-only">Anterior</span>
              <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
              </svg>
            </button>
            <button
              *ngFor="let page of [].constructor(totalPages); let i = index"
              (click)="onPageChange(i + 1)"
              [class.bg-brand-600]="currentPage === i + 1"
              [class.text-white]="currentPage === i + 1"
              [class.text-gray-900]="currentPage !== i + 1"
              [class.ring-gray-300]="currentPage !== i + 1"
              [class.hover:bg-gray-50]="currentPage !== i + 1"
              class="relative inline-flex items-center px-4 py-2 text-sm font-semibold ring-1 ring-inset focus:z-20 focus:outline-offset-0"
            >
              {{ i + 1 }}
            </button>
            <button (click)="onPageChange(currentPage + 1)" [disabled]="currentPage === totalPages" class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50">
              <span class="sr-only">Próxima</span>
              <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
              </svg>
            </button>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- Evidence Sidebar -->
  <div
    *ngIf="isEvidenceSidebarOpen"
    class="fixed inset-0 z-[100000] bg-gray-900/40"
    (click)="closeEvidenceSidebar()"
  ></div>

  <aside
    *ngIf="isEvidenceSidebarOpen"
    class="fixed top-0 right-0 z-[100001] flex h-screen w-full max-w-md flex-col border-l border-gray-200 bg-white shadow-theme-lg dark:border-gray-800 dark:bg-gray-900"
    (click)="$event.stopPropagation()"
  >
    <div class="flex items-center justify-between border-b border-gray-200 px-5 py-4 dark:border-gray-800">
      <div>
        <p class="text-xs font-medium uppercase tracking-wide text-gray-400 dark:text-gray-500">
          {{ 'financial.transactions.offcanvas.subtitle' | translate }}
        </p>
        <h3 class="mt-1 text-base font-semibold text-gray-800 dark:text-white/90">
          {{ selectedTransaction?.description || ('financial.transactions.offcanvas.titleFallback' | translate) }}
        </h3>
      </div>
      <button
        type="button"
        (click)="closeEvidenceSidebar()"
        class="inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 hover:text-gray-800 dark:text-gray-400 dark:hover:bg-gray-800"
      >
        <svg class="h-4 w-4" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3.5 3.5L10.5 10.5M10.5 3.5L3.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="flex-1 overflow-y-auto px-5 py-4 space-y-6">
      <div class="space-y-3">
        <div class="flex flex-wrap items-center gap-2">
          <span
            *ngIf="selectedTransaction?.type"
            [ngClass]="{
              'bg-red-50 text-red-600 dark:bg-red-500/10 dark:text-red-500': (selectedTransaction?.type || 'PAYABLE') === 'PAYABLE',
              'bg-blue-50 text-blue-600 dark:bg-blue-500/10 dark:text-blue-500': selectedTransaction?.type === 'RECEIVABLE' || selectedTransaction?.type === 'TRANSFER',
              'bg-yellow-50 text-yellow-600 dark:bg-yellow-500/10 dark:text-yellow-500': selectedTransaction?.type === 'ADJUSTMENT'
            }"
            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
          >
            {{ selectedTransaction?.type === 'PAYABLE' ? ('financial.transactions.type.payable' | translate) : 
               selectedTransaction?.type === 'RECEIVABLE' ? ('financial.transactions.type.receivable' | translate) :
               selectedTransaction?.type === 'TRANSFER' ? ('financial.transactions.type.transfer' | translate) :
               selectedTransaction?.type === 'ADJUSTMENT' ? ('financial.transactions.type.adjustment' | translate) : ('financial.transactions.type.payable' | translate) }}
          </span>

          <app-badge *ngIf="selectedTransaction?.status" [color]="getBadgeColor(selectedTransaction?.status!)">
             {{ selectedTransaction?.status | translate }}
          </app-badge>
        </div>

        <dl class="grid grid-cols-1 gap-y-2 text-sm text-gray-600 dark:text-gray-300">
          <div class="flex items-center justify-between gap-4">
            <dt class="text-xs font-medium text-gray-500 dark:text-gray-400">
              {{ 'financial.transactions.offcanvas.fields.nf' | translate }}
            </dt>
            <dd class="text-sm text-gray-800 dark:text-white/90 truncate max-w-[220px]">
              {{ selectedTransaction?.nf || '-' }}
            </dd>
          </div>
          <div class="flex items-center justify-between gap-4">
            <dt class="text-xs font-medium text-gray-500 dark:text-gray-400">
              {{ 'financial.transactions.offcanvas.fields.amount' | translate }}
            </dt>
            <dd class="text-sm text-gray-800 dark:text-white/90">
              {{ selectedTransaction?.amount }}
            </dd>
          </div>
          <div class="flex items-center justify-between gap-4">
            <dt class="text-xs font-medium text-gray-500 dark:text-gray-400">
              {{ 'financial.transactions.offcanvas.fields.dueDate' | translate }}
            </dt>
            <dd class="text-sm text-gray-800 dark:text-white/90">
              {{ selectedTransaction?.date }}
            </dd>
          </div>
          <div class="flex items-center justify-between gap-4">
            <dt class="text-xs font-medium text-gray-500 dark:text-gray-400">
              {{ 'financial.transactions.offcanvas.fields.category' | translate }}
            </dt>
            <dd class="text-sm text-gray-800 dark:text-white/90 truncate max-w-[220px]">
              {{ selectedTransaction?.category || '-' }}
            </dd>
          </div>
        </dl>
      </div>

      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <h4 class="text-sm font-semibold text-gray-800 dark:text-white/90">
            {{ 'financial.evidence.title' | translate }}
          </h4>
        </div>

        <ng-container *ngIf="selectedEvidenceItems.length > 0; else noEvidence">
          <div class="space-y-2">
            <div
              *ngFor="let item of selectedEvidenceItems"
              class="flex items-center gap-3 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 dark:border-gray-800 dark:bg-gray-900"
            >
              <div class="flex h-10 w-10 items-center justify-center overflow-hidden rounded-md bg-gray-200 dark:bg-gray-800">
                <img
                  *ngIf="item.type === 'image' && item.url"
                  [src]="item.url"
                  alt="Evidência"
                  class="h-full w-full object-cover"
                />
                <span *ngIf="item.type !== 'image'" class="text-xs font-semibold uppercase text-gray-700 dark:text-gray-200">
                  {{ item.extension || 'ARQ' }}
                </span>
              </div>
              <div class="min-w-0 flex-1">
                <p class="truncate text-xs font-medium text-gray-800 dark:text-white/90">
                  {{ item.name }}
                </p>
                <p class="text-[11px] text-gray-500 dark:text-gray-400">
                  {{ item.type === 'pdf' ? 'PDF' : (item.type === 'image' ? 'Imagem' : 'Arquivo') }}
                </p>
              </div>
              <button
                type="button"
                class="inline-flex h-7 w-7 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 hover:text-brand-500 dark:text-gray-400 dark:hover:bg-gray-800"
                (click)="openEvidenceItem(item)"
              >
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2.25 12C3.5 7.75 7.25 5 12 5C16.75 5 20.5 7.75 21.75 12C20.5 16.25 16.75 19 12 19C7.25 19 3.5 16.25 2.25 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M15 12C15 13.6569 13.6569 15 12 15C10.3431 15 9 13.6569 9 12C9 10.3431 10.3431 9 12 9C13.6569 9 15 10.3431 15 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </ng-container>

        <ng-template #noEvidence>
          <div class="rounded-lg border border-dashed border-gray-300 bg-gray-50 px-4 py-3 text-xs text-gray-500 dark:border-gray-700 dark:bg-gray-900/40 dark:text-gray-400">
            {{ 'financial.evidence.noEvidence' | translate }}
          </div>
        </ng-template>
      </div>
    </div>
  </aside>

  <!-- Delete Modal -->
  <div *ngIf="isDeleteModalOpen" class="fixed inset-0 z-50 flex items-center justify-center overflow-y-auto overflow-x-hidden bg-gray-900/50 p-4 backdrop-blur-sm transition-all">
    <div class="relative w-full max-w-md rounded-2xl bg-white p-6 shadow-xl dark:bg-gray-900">
      <div class="mb-6 flex items-center justify-between">
        <h3 class="text-xl font-semibold text-gray-800 dark:text-white">
          {{ 'financial.transactions.modals.delete.title' | translate }}
        </h3>
        <button (click)="cancelDelete()" class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 text-gray-500 hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="mb-8">
        <div class="mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-red-50 text-red-500 dark:bg-red-500/10 mx-auto">
          <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
          </svg>
        </div>
        <p class="text-center text-gray-600 dark:text-gray-400">
          {{ 'financial.transactions.modals.delete.message' | translate }}
          <br>
          <span class="font-medium text-gray-900 dark:text-white mt-2 block">{{ transactionToDelete?.description }}</span>
        </p>
      </div>

      <div class="flex items-center justify-center gap-3">
        <button (click)="cancelDelete()" class="w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700">
          {{ 'financial.transactions.actions.cancel' | translate }}
        </button>
        <button (click)="confirmDelete()" class="w-full rounded-lg bg-red-500 px-4 py-2.5 text-sm font-medium text-white shadow-sm hover:bg-red-600 focus:ring-4 focus:ring-red-500/30 dark:bg-red-600 dark:hover:bg-red-700">
          {{ 'financial.transactions.actions.delete' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Offcanvas for Details -->
  <div *ngIf="isOffcanvasOpen" class="fixed inset-0 z-50 flex justify-end bg-gray-900/50 backdrop-blur-sm transition-all" (click)="closeOffcanvas()">
    <div class="relative h-full w-full max-w-md bg-white p-6 shadow-xl dark:bg-gray-900 overflow-y-auto" (click)="$event.stopPropagation()">
      <div class="mb-6 flex items-center justify-between">
        <h3 class="text-xl font-semibold text-gray-800 dark:text-white">
          {{ 'financial.transactions.details.title' | translate }}
        </h3>
        <button (click)="closeOffcanvas()" class="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 text-gray-500 hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div *ngIf="selectedTransaction" class="space-y-6">
        <!-- Details Content -->
        <div class="space-y-4">
          <div>
            <label class="block text-xs font-medium text-gray-500 uppercase tracking-wide dark:text-gray-400">
              {{ 'financial.transactions.details.description' | translate }}
            </label>
            <p class="mt-1 text-base font-medium text-gray-900 dark:text-white">{{ selectedTransaction.description }}</p>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-xs font-medium text-gray-500 uppercase tracking-wide dark:text-gray-400">
                {{ 'financial.transactions.details.amount' | translate }}
              </label>
              <p class="mt-1 text-lg font-bold text-gray-900 dark:text-white">{{ selectedTransaction.amount }}</p>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-500 uppercase tracking-wide dark:text-gray-400">
                {{ 'financial.transactions.details.date' | translate }}
              </label>
              <p class="mt-1 text-base text-gray-900 dark:text-white">{{ selectedTransaction.date }}</p>
            </div>
          </div>

          <div>
            <label class="block text-xs font-medium text-gray-500 uppercase tracking-wide dark:text-gray-400">
              {{ 'financial.transactions.details.category' | translate }}
            </label>
            <div class="mt-1 flex items-center gap-2">
              <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800 dark:bg-gray-800 dark:text-gray-200">
                {{ selectedTransaction.category }}
              </span>
            </div>
          </div>

          <div>
             <label class="block text-xs font-medium text-gray-500 uppercase tracking-wide dark:text-gray-400">
               Status
             </label>
             <div class="mt-1">
               <app-badge [color]="getBadgeColor(selectedTransaction.status)">
                 {{ selectedTransaction.status | translate }}
               </app-badge>
             </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>